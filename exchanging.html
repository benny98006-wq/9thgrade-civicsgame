<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸‰å…¬æ°‘ï¼šåŒ¯ç‡èˆ‡è²¿æ˜“äº’å‹•å¯¦é©—å®¤</title>
    <style>
        /* åŸºç¤è¨­å®š */
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #f72585;
            --success: #2a9d8f;
            --danger: #e63946;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
        }

        body {
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background-color: var(--bg);
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1, h2 {
            text-align: center;
            color: var(--secondary);
        }

        .header-box {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #00b4d8 0%, #0077b6 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border-left: 5px solid var(--primary);
        }

        /* Part 1 & 2 æ¨£å¼ */
        .mode-switch { display: flex; justify-content: center; margin-bottom: 20px; gap: 10px; }
        .mode-btn { padding: 10px 20px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 30px; cursor: pointer; font-weight: bold; }
        .mode-btn.active { background: var(--primary); color: white; }
        .calculator-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: center; }
        input, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .result-box { background-color: #eef2ff; padding: 20px; border-radius: 8px; margin-top: 20px; text-align: center; }
        .math-step { color: #d63384; font-size: 1.1em; margin-top: 10px; font-family: "Consolas", monospace; font-weight: bold; background: #fff; padding: 10px; border-radius: 5px; border: 1px dashed #ccc; }
        .highlight { color: var(--secondary); font-weight: bold; font-size: 1.8em; }
        .btn { background-color: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 50px; cursor: pointer; font-size: 18px; margin: 5px; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-secondary { background-color: #6c757d; }
        
        /* Part 2 è²¿æ˜“æ¨¡æ“¬å™¨å°ˆç”¨æ¨£å¼ */
        .trade-area { border-left-color: var(--success); background-color: #f1fcf9; }
        .role-selection { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .role-card { border: 2px solid #ccc; border-radius: 10px; padding: 15px; width: 45%; text-align: center; cursor: pointer; transition: 0.3s; background: white; }
        .role-card:hover { transform: scale(1.03); border-color: var(--primary); }
        .role-card.selected { border-color: var(--primary); background-color: #e3f2fd; box-shadow: 0 0 10px rgba(67, 97, 238, 0.3); }
        .emoji-icon { font-size: 3rem; display: block; margin-bottom: 10px; }
        .control-panel { display: flex; justify-content: space-around; align-items: center; background: #fff; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid #ddd; }
        .rate-display { font-size: 1.5rem; font-weight: bold; color: var(--secondary); }
        .profit-display { margin-top: 20px; text-align: center; padding: 15px; border-radius: 10px; font-size: 1.2rem; }
        .profit-up { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .profit-down { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

        /* æ‰‹æ©Ÿç‰ˆèª¿æ•´ */
        @media (max-width: 600px) {
            .calculator-grid { grid-template-columns: 1fr; }
            .role-selection { flex-direction: column; align-items: center; }
            .role-card { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-box">
        <h1>ğŸŒ åœ‹ä¸‰å…¬æ°‘ï¼šåŒ¯ç‡å…¨æ”»ç•¥</h1>
        <p>å¾è¨ˆç®—åˆ°è²¿æ˜“ï¼šæŒæ¡ã€Œå‡å€¼èˆ‡è²¶å€¼ã€çš„é—œéµå½±éŸ¿</p>
    </div>

    <div class="card">
        <h2>ğŸ§® Part 1. åŒ¯ç‡è¨ˆç®—æ©Ÿ</h2>
        <div class="mode-switch">
            <button class="mode-btn active" onclick="setMode('twdToForeign')" id="btnTwdToForeign">ğŸ‡¹ğŸ‡¼ å°å¹£ â âœˆï¸ å¤–å¹£</button>
            <button class="mode-btn" onclick="setMode('foreignToTwd')" id="btnForeignToTwd">âœˆï¸ å¤–å¹£ â ğŸ‡¹ğŸ‡¼ å°å¹£</button>
        </div>
        <p id="instructionText">æˆ‘æœ‰å°å¹£ï¼Œæƒ³æ›æˆå¤–å¹£ï¼ˆå‡ºåœ‹ç©ï¼‰ï¼š</p>
        <div class="calculator-grid">
            <div>
                <label id="labelInput">ğŸ’° è¼¸å…¥å°å¹£é‡‘é¡</label>
                <input type="number" id="amountInput" placeholder="ä¾‹å¦‚: 1000" oninput="calculate()">
            </div>
            <div>
                <label id="labelSelect">âœˆï¸ é¸æ“‡å¤–å¹£</label>
                <select id="currencySelect" onchange="calculate()">
                    </select>
            </div>
        </div>
        <div class="result-box">
            <div>æ›ç®—çµæœï¼š</div>
            <div class="highlight" id="resultText">0</div>
            <div class="math-step" id="mathStep">è«‹è¼¸å…¥é‡‘é¡</div>
        </div>
    </div>

    <div class="card trade-area">
        <h2>ğŸ­ Part 2. è€é—†æ¨¡æ“¬å™¨ï¼šå‡å€¼é‚„æ˜¯è²¶å€¼å¥½ï¼Ÿ</h2>
        <p>è«‹å…ˆé¸æ“‡ä½ è¦ç•¶å“ªä¸€ç¨®è€é—†ï¼š</p>
        
        <div class="role-selection">
            <div class="role-card" id="roleExport" onclick="selectRole('export')">
                <span class="emoji-icon">ğŸ§‹</span>
                <h3>å‡ºå£å•† (è³£çå¥¶)</h3>
                <p>æŠŠå°ç£çå¥¶è³£åˆ°ç¾åœ‹<br>è³ºçš„æ˜¯ç¾é‡‘ (USD)</p>
            </div>
            <div class="role-card" id="roleImport" onclick="selectRole('import')">
                <span class="emoji-icon">ğŸ‘Ÿ</span>
                <h3>é€²å£å•† (è²·çƒé‹)</h3>
                <p>å¾ç¾åœ‹è²·çƒé‹å›å°ç£<br>ä»˜çš„æ˜¯ç¾é‡‘ (USD)</p>
            </div>
        </div>

        <div id="simulationArea" style="display:none;">
            <div class="control-panel">
                <button class="btn" onclick="changeRate(-1)">ğŸ“ˆ å°å¹£å‡å€¼<br><small>(ç¾é‡‘è®Šä¾¿å®œ)</small></button>
                <div style="text-align: center;">
                    <div>ç›®å‰åŒ¯ç‡</div>
                    <div class="rate-display">1 USD = <span id="simRate">30</span> TWD</div>
                </div>
                <button class="btn btn-secondary" onclick="changeRate(1)">ğŸ“‰ å°å¹£è²¶å€¼<br><small>(ç¾é‡‘è®Šè²´)</small></button>
            </div>

            <div id="scenarioDescription" style="margin-top: 15px; font-weight: bold; text-align: center;"></div>

            <div id="profitBox" class="profit-display">
                </div>
        </div>
    </div>

    <div class="card">
        <h2>ğŸ® Part 3. ç¶œåˆç·´ç¿’ï¼šè³¼ç‰©ç›´è¦ºæŒ‘æˆ°</h2>
        <div style="text-align: center;">
            <button class="btn" onclick="newQuestion()">ğŸ² éš¨æ©Ÿå‡ºé¡Œ</button>
        </div>
        <div id="questionBox" style="margin-top: 20px; display: none;">
            <h3 id="scenarioText" style="text-align:center; color:var(--primary);">é¡Œç›®è¼‰å…¥ä¸­...</h3>
            
            <div style="font-size: 1.2em; text-align: center; margin: 15px 0;">
                <p>å•†å“æ¨™åƒ¹ï¼š<strong style="color: #d63384; font-size: 1.5em;" id="itemPrice"></strong> <span id="itemCurrency"></span></p>
                <p>åƒè€ƒåŒ¯ç‡ï¼š1 <span id="itemCurrencyName"></span> = <strong id="currentRate"></strong> å°å¹£</p>
            </div>
            
            <p style="text-align: center;">â“ è«‹å•é€™å¤§ç´„ç­‰æ–¼å¤šå°‘å°å¹£ï¼Ÿ</p>
            
            <div id="optionsArea" style="text-align: center;"></div>
            
            <div id="gameFeedback" class="feedback" style="text-align: center; margin-top: 10px;"></div>
        </div>
    </div>

</div>

<script>
    // --- å…¨åŸŸè®Šæ•¸èˆ‡è³‡æ–™ ---
    const currencies = {
        USD: { name: "ç¾é‡‘", symbol: "USD", rateToTWD: 32.5, rateFromTWD: 0.0307 },
        JPY: { name: "æ—¥åœ“", symbol: "JPY", rateToTWD: 0.215, rateFromTWD: 4.651 },
        EUR: { name: "æ­å…ƒ", symbol: "EUR", rateToTWD: 34.5, rateFromTWD: 0.0289 },
        KRW: { name: "éŸ“å…ƒ", symbol: "KRW", rateToTWD: 0.0235, rateFromTWD: 42.55 }
    };

    // --- Part 1: è¨ˆç®—æ©Ÿé‚è¼¯ ---
    let currentMode = 'twdToForeign';

    function initCalculator() {
        const select = document.getElementById('currencySelect');
        select.innerHTML = '';
        for (let key in currencies) {
            let option = document.createElement('option');
            option.value = key;
            option.text = `${currencies[key].name} (${currencies[key].symbol})`;
            select.add(option);
        }
        calculate();
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('btnTwdToForeign').className = mode === 'twdToForeign' ? 'mode-btn active' : 'mode-btn';
        document.getElementById('btnForeignToTwd').className = mode === 'foreignToTwd' ? 'mode-btn active' : 'mode-btn';
        
        if (mode === 'twdToForeign') {
            document.getElementById('instructionText').innerText = "æˆ‘æœ‰å°å¹£ï¼Œæƒ³æ›æˆå¤–å¹£ï¼š";
            document.getElementById('labelInput').innerText = "ğŸ’° è¼¸å…¥å°å¹£é‡‘é¡";
            document.getElementById('amountInput').placeholder = "ä¾‹å¦‚: 1000";
        } else {
            document.getElementById('instructionText').innerText = "æˆ‘æœ‰å¤–å¹£ï¼Œæƒ³æ›å›å°å¹£ï¼š";
            document.getElementById('labelInput').innerText = "âœˆï¸ è¼¸å…¥å¤–å¹£é‡‘é¡";
            document.getElementById('amountInput').placeholder = "ä¾‹å¦‚: 10";
        }
        calculate();
    }

    function calculate() {
        const amount = parseFloat(document.getElementById('amountInput').value);
        const currencyKey = document.getElementById('currencySelect').value;
        const data = currencies[currencyKey];
        const resultDiv = document.getElementById('resultText');
        const stepDiv = document.getElementById('mathStep');

        if (isNaN(amount)) {
            resultDiv.innerText = "0";
            stepDiv.innerText = "è«‹è¼¸å…¥æ•¸å­—";
            return;
        }

        if (currentMode === 'twdToForeign') {
            // å°å¹£æ›å¤–å¹£
            const result = amount * data.rateFromTWD;
            resultDiv.innerText = `${result.toFixed(2)} ${data.symbol}`;
            stepDiv.innerHTML = `${amount} (å°å¹£) âœ–ï¸ ${data.rateFromTWD} (åŒ¯ç‡) = ${result.toFixed(2)} ${data.symbol}`;
        } else {
            // å¤–å¹£æ›å°å¹£
            const result = amount * data.rateToTWD;
            resultDiv.innerText = `${Math.round(result)} TWD`;
            stepDiv.innerHTML = `${amount} (${data.symbol}) âœ–ï¸ ${data.rateToTWD} (åŒ¯ç‡) = ${Math.round(result)} å°å¹£`;
        }
    }

    // --- Part 2: è²¿æ˜“æ¨¡æ“¬å™¨é‚è¼¯ ---
    let currentRole = ''; 
    let simRate = 30; 
    const baseRate = 30;
    const goodsPriceUSD = 100; 

    function selectRole(role) {
        currentRole = role;
        document.getElementById('roleExport').className = role === 'export' ? 'role-card selected' : 'role-card';
        document.getElementById('roleImport').className = role === 'import' ? 'role-card selected' : 'role-card';
        document.getElementById('simulationArea').style.display = 'block';
        
        simRate = 30;
        updateSimulation();
    }

    function changeRate(change) {
        simRate += change;
        if(simRate < 25) simRate = 25;
        if(simRate > 35) simRate = 35;
        updateSimulation();
    }

    function updateSimulation() {
        document.getElementById('simRate').innerText = simRate;
        const profitBox = document.getElementById('profitBox');
        const desc = document.getElementById('scenarioDescription');
        
        const amountTWD = goodsPriceUSD * simRate;
        const baseAmountTWD = goodsPriceUSD * baseRate;
        const diff = amountTWD - baseAmountTWD;

        if (currentRole === 'export') {
            desc.innerText = `æƒ…å¢ƒï¼šä½ è³£å‡º 100 ç¾é‡‘çš„çå¥¶ï¼Œè¦å»éŠ€è¡Œæ›å›å°å¹£...`;
            if (simRate > baseRate) {
                profitBox.className = "profit-display profit-up";
                profitBox.innerHTML = `<h3>ğŸ˜„ è³ºåˆ°äº†ï¼</h3><p>å¤šè³ºäº† ${diff} å…ƒï¼ (å°å¹£è²¶å€¼æœ‰åˆ©å‡ºå£)</p>`;
            } else if (simRate < baseRate) {
                profitBox.className = "profit-display profit-down";
                profitBox.innerHTML = `<h3>ğŸ˜­ ç¸®æ°´äº†ï¼</h3><p>å°‘è³ºäº† ${Math.abs(diff)} å…ƒï¼ (å°å¹£å‡å€¼ä¸åˆ©å‡ºå£)</p>`;
            } else {
                profitBox.className = "profit-display";
                profitBox.innerHTML = `<h3>ğŸ˜ åŒ¯ç‡æŒå¹³</h3><p>æ”¶å…¥æ­£å¸¸ã€‚</p>`;
            }
        } else {
            desc.innerText = `æƒ…å¢ƒï¼šä½ è¦è²· 100 ç¾é‡‘çš„çƒé‹ï¼Œè¦æ‹¿å°å¹£å»éŠ€è¡Œæ›...`;
            if (simRate > baseRate) {
                profitBox.className = "profit-display profit-down";
                profitBox.innerHTML = `<h3>ğŸ˜­ è®Šè²´äº†ï¼</h3><p>å¤šèŠ±äº† ${diff} å…ƒï¼ (å°å¹£è²¶å€¼ä¸åˆ©é€²å£)</p>`;
            } else if (simRate < baseRate) {
                profitBox.className = "profit-display profit-up";
                profitBox.innerHTML = `<h3>ğŸ˜„ è®Šä¾¿å®œäº†ï¼</h3><p>çœä¸‹äº† ${Math.abs(diff)} å…ƒï¼ (å°å¹£å‡å€¼æœ‰åˆ©é€²å£)</p>`;
            } else {
                profitBox.className = "profit-display";
                profitBox.innerHTML = `<h3>ğŸ˜ åŒ¯ç‡æŒå¹³</h3><p>åƒ¹æ ¼æ­£å¸¸ã€‚</p>`;
            }
        }
    }

    // --- Part 3: è³¼ç‰©æŒ‘æˆ° (ä¿®æ­£å¾Œ) ---
    function newQuestion() {
        const keys = Object.keys(currencies);
        const randomKey = keys[Math.floor(Math.random() * keys.length)];
        const data = currencies[randomKey];
        
        // éš¨æ©Ÿç”Ÿæˆåƒ¹æ ¼
        const price = Math.floor(Math.random() * 50) * 10 + 10; 
        const realCostTWD = Math.round(price * data.rateToTWD);
        
        // 1. é¡¯ç¤ºéš±è—çš„å€å¡Š
        document.getElementById('questionBox').style.display = 'block';
        
        // 2. æ¸…ç©ºä¸¦æ›´æ–° UI
        document.getElementById('gameFeedback').innerText = '';
        
        // æ›´æ–°æƒ…å¢ƒæ–‡å­— (å…ˆå‰ç‰ˆæœ¬æ¼äº†é€™è¡Œ)
        document.getElementById('scenarioText').innerText = `ä½ åœ¨ ${data.name} çš„å•†åº—çœ‹ä¸Šäº†ä¸€å€‹å•†å“`;
        
        document.getElementById('itemPrice').innerText = price;
        document.getElementById('itemCurrency').innerText = data.symbol;
        document.getElementById('itemCurrencyName').innerText = data.name;
        document.getElementById('currentRate').innerText = data.rateToTWD;

        generateOptions(realCostTWD, price, data.rateToTWD);
    }

    function generateOptions(correctAnswer, price, rate) {
        const optionsDiv = document.getElementById('optionsArea');
        optionsDiv.innerHTML = ''; // æ¸…ç©ºèˆŠé¸é …
        
        // ç”Ÿæˆä¸‰å€‹é¸é …
        let answers = [
            correctAnswer, 
            Math.round(correctAnswer * 1.5), 
            Math.round(correctAnswer * 0.6)
        ];
        // æ´—ç‰Œ
        answers.sort(() => Math.random() - 0.5);

        answers.forEach(ans => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-secondary';
            btn.innerText = `ç´„ ${ans} å…ƒ`;
            // é»æ“Šäº‹ä»¶
            btn.onclick = () => {
                const feedback = document.getElementById('gameFeedback');
                if (ans === correctAnswer) {
                    feedback.innerText = "ğŸ‰ ç­”å°äº†ï¼";
                    feedback.style.color = "green";
                } else {
                    feedback.innerText = `ğŸ˜… éŒ¯å›‰ï¼æ­£ç¢ºæ˜¯ï¼š${price} Ã— ${rate} = ${correctAnswer}`;
                    feedback.style.color = "red";
                }
            };
            optionsDiv.appendChild(btn);
        });
    }

    // åˆå§‹åŒ–è¨ˆç®—æ©Ÿ
    initCalculator();
</script>

</body>
</html>