<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ˜äº¤æ˜“é€²åŒ–è«–ï¼šè²¨å¹£æ¼”é€²æ¨¡æ“¬å™¨</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom CSS for Animations -->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideInBottom {
            from { transform: translateY(1rem); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes zoomIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .animate-in { animation-duration: 0.5s; animation-fill-mode: both; }
        .fade-in { animation-name: fadeIn; }
        .slide-in-from-bottom-4 { animation-name: slideInBottom; }
        .zoom-in { animation-name: zoomIn; }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-100 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons Components (Lucide replicas) ---
        const Icon = ({ children, className, ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const ArrowRight = (props) => <Icon {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></Icon>;
        const ShoppingBag = (props) => <Icon {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></Icon>;
        const Coins = (props) => <Icon {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></Icon>;
        const CreditCard = (props) => <Icon {...props}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></Icon>;
        const Hammer = (props) => <Icon {...props}><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V7.86c0-.55-.45-1-1-1H14.5c-.85 0-1.65-.33-2.25-.93L11 4.71"/><path d="M11.5 5.5 18.5 12.5"/></Icon>;
        const Wheat = (props) => <Icon {...props}><path d="M2 22 16 8"/><path d="M3.47 12.53 5 11l1.53 1.53a3.5 3.5 0 0 1 0 4.94L5 19l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M7.47 8.53 9 7l1.53 1.53a3.5 3.5 0 0 1 0 4.94L9 15l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M11.47 4.53 13 3l1.53 1.53a3.5 3.5 0 0 1 0 4.94L13 11l-1.53-1.53a3.5 3.5 0 0 1 0-4.94Z"/><path d="M20 2h2v2a4 4 0 0 1-4 4h-2V6a4 4 0 0 1 4-4Z"/><path d="M11.47 17.47 13 19l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L5 19l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/><path d="M15.47 13.47 17 15l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L9 15l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/><path d="M19.47 9.47 21 11l-1.53 1.53a3.5 3.5 0 0 1-4.94 0L13 11l1.53-1.53a3.5 3.5 0 0 1 4.94 0Z"/></Icon>;
        const Fish = (props) => <Icon {...props}><path d="M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z"/><path d="M18 12v.5"/><path d="M16 17.93a9.77 9.77 0 0 1 0-11.86"/><path d="M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33"/><path d="M10.46 7.26C10.2 7.35 10 7.6 10 8"/><path d="M10.46 16.74c-.26-.09-.46-.34-.46-.74"/></Icon>;
        const Save = (props) => <Icon {...props}><path d="M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"/><path d="M17 21v-8H7v8"/><path d="M7 3v5h8V3"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const AlertCircle = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;


        // --- Stage Components ---

        // Stage 1: Self Sufficiency
        const SelfSufficiencyStage = ({ addLog, playSound, onComplete }) => {
          const [energy, setEnergy] = useState(100);
          const [food, setFood] = useState(0);
          const [clothes, setClothes] = useState(0);
          const [house, setHouse] = useState(0);

          const work = (type) => {
            if (energy < 20) {
              addLog("å¤ªç´¯äº†ï¼ä¼‘æ¯ä¸€ä¸‹å§ã€‚");
              return;
            }
            
            playSound('work');
            setEnergy(e => e - 20);
            
            if (type === 'food') {
              setFood(f => f + 1);
              addLog("ç¨®æ¤äº† 1 ä»½é£Ÿç‰©");
            } else if (type === 'clothes') {
              setClothes(c => c + 1);
              addLog("ç¸«è£½äº† 1 ä»¶è¡£æœ");
            } else if (type === 'house') {
              setHouse(h => h + 1);
              addLog("ä¿®è£œäº† 1 æ¬¡æˆ¿å±‹");
            }
          };

          const rest = () => {
            setEnergy(100);
            addLog("é«”åŠ›æ¢å¾©äº†ï¼");
          };

          const isComplete = food >= 3 && clothes >= 2 && house >= 1;

          return (
            <div className="space-y-6">
              <div className="bg-blue-50 p-4 rounded-lg border border-blue-200 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h3 className="font-bold text-blue-800 text-lg mb-2">ä»»å‹™ç›®æ¨™</h3>
                <p className="text-gray-700">é è‡ªå·±çš„é›™æ‰‹ç”Ÿå­˜ä¸‹å»ï¼ä½ éœ€è¦ç”Ÿç”¢ï¼š</p>
                <ul className="list-disc list-inside mt-2 text-sm">
                  <li className={food >= 3 ? "text-green-600 font-bold transition-colors duration-300" : "transition-colors duration-300"}>3 ä»½é£Ÿç‰© ({food}/3)</li>
                  <li className={clothes >= 2 ? "text-green-600 font-bold transition-colors duration-300" : "transition-colors duration-300"}>2 ä»¶è¡£æœ ({clothes}/2)</li>
                  <li className={house >= 1 ? "text-green-600 font-bold transition-colors duration-300" : "transition-colors duration-300"}>1 é–“æˆ¿å±‹ ({house}/1)</li>
                </ul>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <button onClick={() => work('food')} className="p-4 bg-green-100 hover:bg-green-200 rounded-xl flex flex-col items-center transition active:scale-95 duration-200">
                  <Wheat className="w-8 h-8 text-green-600 mb-2" />
                  <span>ç¨®ç”° (æ¶ˆè€—é«”åŠ›)</span>
                </button>
                <button onClick={() => work('clothes')} className="p-4 bg-purple-100 hover:bg-purple-200 rounded-xl flex flex-col items-center transition active:scale-95 duration-200">
                  <ShoppingBag className="w-8 h-8 text-purple-600 mb-2" />
                  <span>ç¹”å¸ƒ (æ¶ˆè€—é«”åŠ›)</span>
                </button>
                <button onClick={() => work('house')} className="p-4 bg-amber-100 hover:bg-amber-200 rounded-xl flex flex-col items-center transition active:scale-95 duration-200">
                  <Hammer className="w-8 h-8 text-amber-600 mb-2" />
                  <span>è“‹æˆ¿ (æ¶ˆè€—é«”åŠ›)</span>
                </button>
                <button onClick={rest} className="p-4 bg-gray-100 hover:bg-gray-200 rounded-xl flex flex-col items-center transition border-2 border-gray-300 active:scale-95 duration-200">
                  <RefreshCw className="w-8 h-8 text-gray-600 mb-2" />
                  <span>ç¡è¦º (æ¢å¾©é«”åŠ›)</span>
                </button>
              </div>

              <div className="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                <div className={`h-4 rounded-full transition-all duration-500 ease-out ${energy < 30 ? 'bg-red-500' : 'bg-yellow-500'}`} style={{ width: `${energy}%` }}></div>
              </div>
              <p className="text-center text-sm text-gray-500">å‰©é¤˜é«”åŠ›: {energy}%</p>

              {isComplete && (
                <button onClick={onComplete} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold animate-bounce shadow-lg">
                  å®Œæˆä»»å‹™ï¼é€²å…¥ä¸‹ä¸€éšæ®µ
                </button>
              )}
            </div>
          );
        };

        // Stage 2: Barter
        const BarterStage = ({ addLog, onComplete }) => {
          const [myItems, setMyItems] = useState(['fish', 'fish', 'fish']); 
          const [hasAxe, setHasAxe] = useState(false);

          const trade = (npc) => {
            if (npc === 'Hunter') {
              if (myItems.includes('fish')) {
                const newItems = [...myItems];
                newItems.splice(newItems.indexOf('fish'), 1);
                setMyItems([...newItems, 'meat']);
                addLog("æˆåŠŸç”¨ ğŸŸé­š äº¤æ›äº† ğŸ–è‚‰ï¼");
              } else {
                addLog("çµäººèªªï¼šæˆ‘åªæƒ³è¦é­š...");
              }
            } else if (npc === 'Farmer') {
              if (myItems.includes('meat')) {
                const newItems = [...myItems];
                newItems.splice(newItems.indexOf('meat'), 1);
                setMyItems([...newItems, 'apple']);
                addLog("æˆåŠŸç”¨ ğŸ–è‚‰ äº¤æ›äº† ğŸè˜‹æœï¼");
              } else {
                addLog("è¾²å¤«èªªï¼šæˆ‘é¤“äº†ï¼Œæƒ³åƒè‚‰...");
              }
            } else if (npc === 'Blacksmith') {
              if (myItems.includes('apple')) {
                const newItems = [...myItems];
                newItems.splice(newItems.indexOf('apple'), 1);
                setMyItems([...newItems, 'axe']);
                setHasAxe(true);
                addLog("æˆåŠŸç”¨ ğŸè˜‹æœ äº¤æ›äº† ğŸª“æ–§é ­ï¼");
              } else {
                addLog("éµåŒ èªªï¼šå£å¥½æ¸´ï¼Œæœ‰æ°´æœå—ï¼Ÿ");
              }
            }
          };

          return (
            <div className="space-y-6">
              <div className="bg-orange-50 p-4 rounded-lg border border-orange-200 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h3 className="font-bold text-orange-800 text-lg mb-2">ä»»å‹™ç›®æ¨™ï¼šæ›å–ä¸€æŠŠæ–§é ­ ğŸª“</h3>
                <p className="text-gray-700">ä½ æ˜¯ä¸€ä½æ¼å¤«ï¼Œä½ æ‰‹ä¸Šåªæœ‰é­šã€‚ä½ éœ€è¦æ‰¾åˆ°é¡˜æ„è·Ÿä½ äº¤æ›çš„äººï¼Œæœ€çµ‚æ›åˆ°æ–§é ­ã€‚</p>
                <div className="mt-3 flex gap-2 p-2 bg-white rounded border min-h-[50px] items-center">
                  <span className="text-sm font-bold text-gray-500">ä½ çš„èƒŒåŒ…ï¼š</span>
                  {myItems.map((item, i) => (
                     <span key={i} className="text-2xl animate-in zoom-in duration-300" title={item}>
                       {item === 'fish' ? 'ğŸŸ' : item === 'meat' ? 'ğŸ–' : item === 'apple' ? 'ğŸ' : 'ğŸª“'}
                     </span>
                  ))}
                </div>
              </div>

              <div className="grid grid-cols-1 gap-3">
                 {/* Hunter */}
                 <div onClick={() => trade('Hunter')} className="flex items-center justify-between p-4 bg-white shadow-sm border rounded-lg cursor-pointer hover:bg-gray-50 active:scale-95 transition duration-200">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-xl">ğŸ¹</div>
                      <div>
                        <div className="font-bold">çµäºº</div>
                        <div className="text-xs text-gray-500">æ“æœ‰ï¼šğŸ–è‚‰ / æƒ³è¦ï¼šğŸŸé­š</div>
                      </div>
                    </div>
                    <button className="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm font-medium">äº¤æ›</button>
                 </div>

                 {/* Farmer */}
                 <div onClick={() => trade('Farmer')} className="flex items-center justify-between p-4 bg-white shadow-sm border rounded-lg cursor-pointer hover:bg-gray-50 active:scale-95 transition duration-200">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center text-xl">ğŸ‘¨â€ğŸŒ¾</div>
                      <div>
                        <div className="font-bold">è¾²å¤«</div>
                        <div className="text-xs text-gray-500">æ“æœ‰ï¼šğŸè˜‹æœ / æƒ³è¦ï¼šğŸ–è‚‰</div>
                      </div>
                    </div>
                    <button className="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm font-medium">äº¤æ›</button>
                 </div>

                 {/* Blacksmith */}
                 <div onClick={() => trade('Blacksmith')} className="flex items-center justify-between p-4 bg-white shadow-sm border rounded-lg cursor-pointer hover:bg-gray-50 active:scale-95 transition duration-200">
                    <div className="flex items-center gap-3">
                      <div className="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-xl">âš’ï¸</div>
                      <div>
                        <div className="font-bold">éµåŒ </div>
                        <div className="text-xs text-gray-500">æ“æœ‰ï¼šğŸª“æ–§é ­ / æƒ³è¦ï¼šğŸè˜‹æœ</div>
                      </div>
                    </div>
                    <button className="px-3 py-1 bg-blue-100 text-blue-700 rounded text-sm font-medium">äº¤æ›</button>
                 </div>
              </div>

              {hasAxe && (
                <button onClick={onComplete} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold animate-bounce shadow-lg">
                  æ›åˆ°äº†ï¼é«”é©—ä¸‹ä¸€éšæ®µ
                </button>
              )}
            </div>
          );
        };

        // Stage 3: Commodity Money
        const CommodityStage = ({ addLog, onComplete }) => {
          const [shells, setShells] = useState(0);
          const [hasFish, setHasFish] = useState(5);
          const [inventory, setInventory] = useState([]);

          const sellFish = () => {
            if (hasFish > 0) {
              setHasFish(f => f - 1);
              setShells(s => s + 2);
              addLog("è³£å‡ºé­šï¼Œç²å¾— 2 å€‹è²æ®¼ ğŸš");
            } else {
              addLog("æ²’æœ‰é­šå¯ä»¥è³£äº†ï¼");
            }
          };

          const buyItem = (item, price) => {
            if (shells >= price) {
              setShells(s => s - price);
              setInventory([...inventory, item]);
              addLog(`è³¼è²·äº† ${item}ï¼`);
            } else {
              addLog("è²æ®¼ä¸å¤ ï¼å…ˆå»è³£é­šå§ã€‚");
            }
          };

          const isComplete = inventory.includes('é™¶ç½') && inventory.includes('é …éŠ');

          return (
            <div className="space-y-6">
              <div className="bg-teal-50 p-4 rounded-lg border border-teal-200 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h3 className="font-bold text-teal-800 text-lg mb-2">ä»»å‹™ç›®æ¨™ï¼šä½¿ç”¨ã€Œè²æ®¼ã€è³¼ç‰©</h3>
                <p className="text-gray-700">å¤§å®¶ç´„å®šå¥½ç”¨ç¨€æœ‰çš„ã€Œè²æ®¼ã€ç•¶ä½œäº¤æ˜“åª’ä»‹ã€‚å…ˆæŠŠé­šè³£æ‰æ›è²æ®¼ï¼Œå†è²·ä½ éœ€è¦çš„é™¶ç½å’Œé …éŠã€‚</p>
                <div className="flex justify-between items-center mt-4 bg-white p-3 rounded-lg shadow-sm">
                  <div className="text-center">
                    <span className="block text-sm text-gray-500">ä½ çš„åº«å­˜</span>
                    <span className="text-xl font-bold transition-all duration-300">ğŸŸ {hasFish}</span>
                  </div>
                  <ArrowRight className="text-gray-400" />
                  <div className="text-center">
                    <span className="block text-sm text-gray-500">ä½ çš„éŒ¢åŒ…</span>
                    <span className="text-xl font-bold text-teal-600 transition-all duration-300">ğŸš {shells}</span>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <button onClick={sellFish} className="col-span-2 bg-blue-100 p-4 rounded-lg hover:bg-blue-200 transition flex items-center justify-center gap-2 active:scale-95 duration-200">
                   <Fish className="w-5 h-5" />
                   <span className="font-bold">è³£é­š (+2 è²æ®¼)</span>
                </button>

                <button onClick={() => buyItem('é™¶ç½', 3)} disabled={inventory.includes('é™¶ç½')} className={`p-4 border-2 rounded-lg flex flex-col items-center transition duration-200 ${inventory.includes('é™¶ç½') ? 'bg-gray-100 opacity-50' : 'bg-white border-teal-500 hover:bg-teal-50 active:scale-95'}`}>
                  <div className="text-2xl mb-1">ğŸº</div>
                  <div className="font-bold">é™¶ç½</div>
                  <div className="text-sm text-teal-600">3 è²æ®¼</div>
                </button>

                <button onClick={() => buyItem('é …éŠ', 5)} disabled={inventory.includes('é …éŠ')} className={`p-4 border-2 rounded-lg flex flex-col items-center transition duration-200 ${inventory.includes('é …éŠ') ? 'bg-gray-100 opacity-50' : 'bg-white border-teal-500 hover:bg-teal-50 active:scale-95'}`}>
                  <div className="text-2xl mb-1">ğŸ“¿</div>
                  <div className="font-bold">é …éŠ</div>
                  <div className="text-sm text-teal-600">5 è²æ®¼</div>
                </button>
              </div>

              {isComplete && (
                <button onClick={onComplete} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold animate-bounce shadow-lg">
                  è³¼ç‰©å®Œæˆï¼å‰å¾€ç¾ä»£
                </button>
              )}
            </div>
          );
        };

        // Stage 4: Fiat Money
        const FiatStage = ({ addLog, playSound, onFinish }) => {
          const [balance, setBalance] = useState(1000);
          const [items, setItems] = useState([]);

          const work = () => {
            setBalance(b => b + 500);
            addLog("å·¥ä½œç²å¾—è–ªæ°´ $500");
            playSound('ching');
          };

          const buy = (item, price) => {
            if (balance >= price) {
              setBalance(b => b - price);
              setItems([...items, item]);
              addLog(`åˆ·å¡è³¼è²·äº† ${item} -$${price}`);
              playSound('beep');
            } else {
              addLog("é¤˜é¡ä¸è¶³ï¼");
            }
          };

          const isComplete = items.length >= 3;

          return (
            <div className="space-y-6">
              <div className="bg-indigo-50 p-4 rounded-lg border border-indigo-200 animate-in fade-in slide-in-from-bottom-4 duration-500">
                <h3 className="font-bold text-indigo-800 text-lg mb-2">ä»»å‹™ç›®æ¨™ï¼šç¾ä»£ç¶“æ¿Ÿ</h3>
                <p className="text-gray-700">ç¾åœ¨æ˜¯æ³•å®šè²¨å¹£æ™‚ä»£ã€‚åœ‹å®¶ä¿è­‰é€™å¼µç´™/é€™å€‹æ•¸å­—æœ‰åƒ¹å€¼ã€‚è³ºéŒ¢å¾ˆå®¹æ˜“ï¼ŒèŠ±éŒ¢æ›´å¿«ï¼</p>
                
                <div className="mt-4 bg-gradient-to-r from-gray-800 to-gray-600 p-4 rounded-xl text-white shadow-lg flex justify-between items-center transform transition hover:scale-[1.02]">
                   <div className="flex items-center gap-2">
                     <CreditCard className="w-6 h-6" />
                     <span className="tracking-widest">BANK CARD</span>
                   </div>
                   <div className="text-2xl font-mono font-bold">${balance}</div>
                </div>
              </div>

              <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                <button onClick={work} className="flex-shrink-0 w-32 h-32 bg-green-500 hover:bg-green-600 text-white rounded-lg flex flex-col items-center justify-center shadow-md transition active:scale-95 duration-200">
                  <span className="text-3xl mb-2">ğŸ’¼</span>
                  <span className="font-bold">ä¸Šç­è³ºéŒ¢</span>
                </button>

                <button onClick={() => buy('çå¥¶', 60)} className="flex-shrink-0 w-32 h-32 bg-white border-2 border-indigo-100 hover:border-indigo-500 rounded-lg flex flex-col items-center justify-center transition active:scale-95 duration-200">
                  <span className="text-3xl mb-2">ğŸ§‹</span>
                  <span className="font-bold text-sm">çå¥¶ $60</span>
                </button>
                
                <button onClick={() => buy('çƒé‹', 2000)} className="flex-shrink-0 w-32 h-32 bg-white border-2 border-indigo-100 hover:border-indigo-500 rounded-lg flex flex-col items-center justify-center transition active:scale-95 duration-200">
                  <span className="text-3xl mb-2">ğŸ‘Ÿ</span>
                  <span className="font-bold text-sm">çƒé‹ $2000</span>
                </button>

                <button onClick={() => buy('æ‰‹æ©Ÿ', 25000)} className="flex-shrink-0 w-32 h-32 bg-white border-2 border-indigo-100 hover:border-indigo-500 rounded-lg flex flex-col items-center justify-center transition active:scale-95 duration-200">
                  <span className="text-3xl mb-2">ğŸ“±</span>
                  <span className="font-bold text-sm">æ‰‹æ©Ÿ $25000</span>
                </button>
              </div>

              <div className="text-sm text-gray-500 text-center">
                 å·²è³¼è²·ç‰©å“: {items.length}/3
              </div>

              {isComplete && (
                <button onClick={onFinish} className="w-full py-3 bg-indigo-600 text-white rounded-lg font-bold animate-bounce shadow-lg mt-4">
                  æ­å–œé€šé—œï¼æŸ¥çœ‹ç¸½çµ
                </button>
              )}
            </div>
          );
        };

        // Lesson Modal
        const LessonModal = ({ show, stage, onNext }) => {
          if (!show) return null;
          
          let title = "";
          let content = "";

          if (stage === 1) {
            title = "éšæ®µä¸€ç¸½çµï¼šè‡ªçµ¦è‡ªè¶³";
            content = "ä½ ç™¼ç¾äº†å—ï¼Ÿæƒ³è¦ä»€éº¼éƒ½å¾—è‡ªå·±åšï¼Œéå¸¸ç´¯ä¸”æ•ˆç‡å¾ˆä½ã€‚å¦‚æœæ¯å€‹äººåªå°ˆå¿ƒåšä¸€ä»¶äº‹ï¼Œç„¶å¾Œäº’ç›¸äº¤æ›ï¼Œæ•ˆç‡æœƒä¸æœƒæ›´é«˜ï¼Ÿ";
          } else if (stage === 2) {
            title = "éšæ®µäºŒç¸½çµï¼šä»¥ç‰©æ˜“ç‰©";
            content = "é›–ç„¶å¯ä»¥äº¤æ›äº†ï¼Œä½†è¦æ‰¾åˆ°ã€Œå‰›å¥½æƒ³è¦ä½ çš„æ±è¥¿ï¼Œåˆå‰›å¥½æœ‰ä½ æƒ³è¦çš„æ±è¥¿ã€çš„äººå¾ˆé›£ï¼é€™å°±æ˜¯ã€Œé›™é‡æ…¾æœ›å·§åˆã€çš„å›°é›£ã€‚";
          } else if (stage === 3) {
            title = "éšæ®µä¸‰ç¸½çµï¼šå•†å“è²¨å¹£";
            content = "å¤§å®¶ç´„å®šç”¨è²æ®¼ç•¶åª’ä»‹ï¼Œäº¤æ˜“è®Šå¿«äº†ï¼ä½†è²æ®¼ã€é»ƒé‡‘å¯èƒ½æ”œå¸¶ä¸ä¾¿æˆ–æœ‰é‡é‡ï¼Œæ•¸é‡ä¹Ÿæœ‰é™ã€‚";
          }

          return (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-2xl animate-in fade-in zoom-in duration-300">
                <h2 className="text-2xl font-bold text-indigo-700 mb-4">{title}</h2>
                <p className="text-gray-700 text-lg leading-relaxed mb-6">{content}</p>
                <button 
                  onClick={onNext}
                  className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-bold text-lg transition"
                >
                  æ˜ç™½äº†ï¼Œé€²å…¥ä¸‹ä¸€éšæ®µ â†’
                </button>
              </div>
            </div>
          );
        };

        const EvolutionGame = () => {
          const [isStorageEnabled, setIsStorageEnabled] = useState(true);
          
          // Safe localStorage initialization
          const [stage, setStage] = useState(() => {
            try {
              const savedStage = localStorage.getItem('moneyEvolutionStage');
              return savedStage ? parseInt(savedStage, 10) : 0;
            } catch (e) {
              console.warn("Storage access denied, using memory only");
              return 0;
            }
          });

          const [log, setLog] = useState(["æ­¡è¿ä¾†åˆ°äº¤æ˜“çš„ä¸–ç•Œï¼(å–®æ©Ÿå…ç™»å…¥æ¨¡å¼)"]);
          const [showLesson, setShowLesson] = useState(false);

          // Safe localStorage saving
          useEffect(() => {
            try {
              localStorage.setItem('moneyEvolutionStage', stage.toString());
              setIsStorageEnabled(true);
            } catch (e) {
              setIsStorageEnabled(false);
            }
          }, [stage]);

          // Audio effect simulation (visual only)
          const playSound = (type) => {
            // In a real app, we would play sound here. 
          };

          const addLog = (msg) => {
            setLog(prev => [msg, ...prev].slice(0, 3));
          };

          const resetGame = () => {
            if (window.confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿé€²åº¦å°‡æœƒæ­¸é›¶ã€‚")) {
              setStage(0);
              setLog(["éŠæˆ²é‡ç½®"]);
              setShowLesson(false);
              try {
                localStorage.removeItem('moneyEvolutionStage');
              } catch(e) {}
            }
          };

          const handleStageComplete = () => {
            setShowLesson(true);
          };

          const handleNextStage = () => {
            setShowLesson(false);
            setStage(prev => prev + 1);
            setLog(["é€²å…¥æ–°éšæ®µï¼"]);
          };

          return (
            <div className="min-h-screen bg-slate-100 font-sans text-gray-800 flex flex-col items-center justify-center p-4 md:p-8">
              
              {/* Main Game Container */}
              <div className="bg-white w-full max-w-2xl rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                
                {/* Header */}
                <div className="bg-indigo-600 p-4 text-white flex justify-between items-center">
                  <div className="font-bold text-lg flex items-center gap-2">
                    <Coins className="w-6 h-6" />
                    æ–‡æ˜äº¤æ˜“é€²åŒ–è«–
                  </div>
                  <div className="flex items-center gap-3">
                     <div className="flex items-center gap-1 text-xs bg-indigo-700 px-2 py-1 rounded text-indigo-200" title={isStorageEnabled ? "é€²åº¦å°‡è‡ªå‹•å„²å­˜åœ¨æ­¤ç€è¦½å™¨ä¸­" : "ç€è¦½å™¨éš±ç§è¨­å®šå°è‡´ç„¡æ³•å„²å­˜é€²åº¦"}>
                       {isStorageEnabled ? <Save className="w-3 h-3" /> : <AlertCircle className="w-3 h-3 text-yellow-300" />}
                       <span>{isStorageEnabled ? "è‡ªå‹•å­˜æª”" : "æš«å­˜æ¨¡å¼"}</span>
                     </div>
                     <button onClick={resetGame} className="p-1 hover:bg-indigo-500 rounded transition" title="é‡ç½®é€²åº¦">
                       <RotateCcw className="w-4 h-4 text-indigo-100" />
                     </button>
                  </div>
                </div>

                {/* Progress Bar */}
                <div className="bg-indigo-900 p-2 flex justify-around text-xs md:text-sm text-indigo-300">
                   <span className={stage === 1 ? "text-white font-bold underline decoration-2 underline-offset-4" : ""}>1. è‡ªçµ¦è‡ªè¶³</span>
                   <span className="text-indigo-700">â†’</span>
                   <span className={stage === 2 ? "text-white font-bold underline decoration-2 underline-offset-4" : ""}>2. ä»¥ç‰©æ˜“ç‰©</span>
                   <span className="text-indigo-700">â†’</span>
                   <span className={stage === 3 ? "text-white font-bold underline decoration-2 underline-offset-4" : ""}>3. å•†å“è²¨å¹£</span>
                   <span className="text-indigo-700">â†’</span>
                   <span className={stage === 4 ? "text-white font-bold underline decoration-2 underline-offset-4" : ""}>4. æ³•å®šè²¨å¹£</span>
                </div>

                {/* Game Content */}
                <div className="p-6 min-h-[400px] flex flex-col">
                  
                  {stage === 0 && (
                    <div className="text-center space-y-6 my-auto animate-in fade-in zoom-in duration-500">
                      <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900">è²¨å¹£çš„æ¼”é€²</h1>
                      <p className="text-gray-600">é€™æ˜¯ä¸€å€‹äº’å‹•æ¨¡æ“¬å™¨ï¼Œå¸¶ä½ é«”é©—å¾åŸå§‹ç¤¾æœƒåˆ°ç¾ä»£ç¶“æ¿Ÿçš„éç¨‹ã€‚</p>
                      <div className="flex justify-center gap-4 text-4xl my-4 animate-pulse">
                        <span>ğŸŒ¾</span><span>â¡ï¸</span><span>ğŸ¤</span><span>â¡ï¸</span><span>ğŸš</span><span>â¡ï¸</span><span>ğŸ’³</span>
                      </div>
                      <div className="space-y-3">
                         <button onClick={() => setStage(1)} className="px-8 py-4 bg-indigo-600 text-white text-xl rounded-full font-bold shadow-lg hover:bg-indigo-700 hover:scale-105 transition transform active:scale-95">
                           é–‹å§‹æ—…ç¨‹
                         </button>
                         <p className="text-xs text-gray-400">å…ç™»å…¥ãƒ»è‡ªå‹•ç´€éŒ„é€²åº¦</p>
                      </div>
                    </div>
                  )}

                  {stage === 1 && <SelfSufficiencyStage addLog={addLog} playSound={playSound} onComplete={handleStageComplete} />}
                  {stage === 2 && <BarterStage addLog={addLog} onComplete={handleStageComplete} />}
                  {stage === 3 && <CommodityStage addLog={addLog} onComplete={handleStageComplete} />}
                  {stage === 4 && <FiatStage addLog={addLog} playSound={playSound} onFinish={() => setStage(5)} />}
                  
                  {stage === 5 && (
                    <div className="text-center space-y-6 my-auto animate-in fade-in zoom-in duration-500">
                      <div className="text-6xl mb-4 animate-bounce">ğŸ‰</div>
                      <h2 className="text-3xl font-bold text-indigo-800">èª²ç¨‹å®Œæˆï¼</h2>
                      <div className="text-left bg-gray-50 p-6 rounded-lg text-gray-700 space-y-2">
                        <p><strong>å›é¡§é‡é»ï¼š</strong></p>
                        <ul className="list-disc list-inside space-y-1">
                           <li><strong>è‡ªçµ¦è‡ªè¶³ï¼š</strong> ä»€éº¼éƒ½è¦è‡ªå·±åšï¼Œæ²’æ•ˆç‡ã€‚</li>
                           <li><strong>ä»¥ç‰©æ˜“ç‰©ï¼š</strong> éœ€è¦é›™æ–¹éœ€æ±‚å‰›å¥½å»åˆ (é›£)ã€‚</li>
                           <li><strong>å•†å“è²¨å¹£ï¼š</strong> å¤§å®¶éƒ½æ¥å—çš„æ±è¥¿ (å¦‚è²æ®¼)ï¼Œæ–¹ä¾¿äº¤æ˜“ã€‚</li>
                           <li><strong>æ³•å®šè²¨å¹£ï¼š</strong> åœ‹å®¶ä¿¡ç”¨æ“”ä¿ï¼Œè¼•ä¾¿ã€å¥½æ”œå¸¶ã€å¯æ•¸ä½åŒ–ã€‚</li>
                        </ul>
                      </div>
                      <button onClick={() => {
                        if(window.confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
                          setStage(0);
                          try { localStorage.removeItem('moneyEvolutionStage'); } catch(e) {}
                        }
                      }} className="px-6 py-3 bg-gray-800 text-white rounded-lg font-bold hover:bg-gray-900 transition">
                        é‡æ–°é«”é©—
                      </button>
                    </div>
                  )}

                </div>

                {/* Log Area */}
                {stage > 0 && stage < 5 && (
                   <div className="bg-gray-100 p-3 border-t border-gray-200 h-24 overflow-hidden">
                     <div className="text-xs font-bold text-gray-400 uppercase mb-1 flex justify-between">
                        <span>ç³»çµ±è¨Šæ¯</span>
                        <span className="text-gray-300 font-normal">Guest Mode</span>
                     </div>
                     {log.map((msg, i) => (
                       <div key={i} className={`text-sm ${i === 0 ? 'text-gray-800 font-medium' : 'text-gray-400'}`}>
                         {i === 0 ? '> ' : ''}{msg}
                       </div>
                     ))}
                   </div>
                )}
              </div>

              <LessonModal show={showLesson} stage={stage} onNext={handleNextStage} />
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EvolutionGame />);
    </script>
</body>
</html>